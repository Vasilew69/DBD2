<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Levels Settings | <%= client && client.user ? client.user.username : 'Bot Offline' %>
  </title>
  <link href="https://fonts.googleapis.com/css?family=Fira+Sans:400,500,600" rel="stylesheet" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.0/css/all.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.9/flatpickr.min.js"
    integrity="sha512-+ruHlyki4CepPr07VklkX/KM5NXdD16K1xVwSva5VqOVbsotyCQVKEwdQ1tAeo3UkHCXfSMtKU/mZpKjYqkxZA=="
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="../<%= theme.theme %>" data-skin="default" />
</head>

<body>
  <header class="app-header app-header-dark">
    <div class="top-bar">
      <div class="top-bar-brand">
        <h5>Dashboard</h5>
      </div>
      <div class="top-bar-list">
        <div class="top-bar-item px-2 d-md-none d-lg-none d-xl-none">
          <button class="hamburger hamburger-squeeze" type="button" data-toggle="aside" aria-label="toggle menu"><span
              class="hamburger-box"><span class="hamburger-inner"></span></span></button>
        </div>
        <div class="top-bar-item top-bar-item-right px-0 d-none d-sm-flex">
          <div class="dropdown d-none d-md-flex">
            <button class="btn-account" type="button" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false"><span class="user-avatar user-avatar-md"><img
                  src="https://cdn.discordapp.com/avatars/<%= profile.id %>/<%= profile.avatar %>" alt=""></span> <span
                class="account-summary pr-lg-4 d-none d-lg-block"><span class="account-name">
                  <%= profile.username %>
                </span> <span class="account-description">Admin</span></span></button>
            <div class="dropdown-menu">
              <div class="dropdown-arrow d-lg-none" x-arrow=""></div>
              <div class="dropdown-arrow ml-3 d-none d-lg-block"></div>
              <h6 class="dropdown-header d-none d-md-block d-lg-none">
                <%= profile.username %>
              </h6><a class="dropdown-item" href="/logout"><span class="dropdown-icon oi oi-account-logout"></span>
                Logout</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <aside class="app-aside app-aside-expand-md app-aside-light">
    <div class="aside-content">
      <header class="aside-header d-block d-md-none">
        <button class="btn-account" type="button" data-toggle="collapse" data-target="#dropdown-aside"><span
            class="user-avatar user-avatar-lg"><img
              src="https://cdn.discordapp.com/avatars/<%= profile.id %>/<%= profile.avatar %>" alt=""></span> <span
            class="account-icon"><span class="fa fa-caret-down fa-lg"></span></span> <span class="account-summary"><span
              class="account-name">
              <%= profile.username %>
            </span> <span class="account-description">Admin</span></span></button> <!-- /.btn-account -->
        <div id="dropdown-aside" class="dropdown-aside collapse">
          <div class="pb-3">
            <a class="dropdown-item" href="/logout"><span class="dropdown-icon oi oi-account-logout"></span> Logout</a>
          </div>
        </div>
      </header>
      <div class="aside-menu overflow-hidden">
        <nav id="stacked-menu" class="stacked-menu">
          <ul class="menu">
            <li class="menu-item">
              <a href="/" class="menu-link">
                <span class="menu-icon fas fa-home"></span> <span class="menu-text">Dashboard</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="/commands" class="menu-link">
                <span class="menu-icon fas fa-rocket"></span> <span class="menu-text">Commands</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="/guilds" class="menu-link">
                <span class="menu-icon fas fa-server"></span> <span class="menu-text">Guilds</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="/support" class="menu-link">
                <span class="menu-icon fas fa-question-circle"></span> <span class="menu-text">Support</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="/settings" class="menu-link">
                <span class="menu-icon fas fa-cog"></span> <span class="menu-text">Settings</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="/activity" class="menu-link">
                <span class="menu-icon fas fa-trophy"></span> <span class="menu-text">Activity</span>
              </a>
            </li>

            <li class="menu-item dropdown has-active">
              <button class="menu-link dropdown-toggle" data-toggle="dropdown"
                style="width: 100%; text-align: left; background: none; border: none;">
                <span class="menu-icon fas fa-plug"></span> <span class="menu-text">Server Plugins</span>
              </button>
              <ul class="dropdown-menu" style="display: none; list-style: none; padding-left: 20px;">
                <li class="menu-item">
                  <a href="/plugins?guildId=<%=guildId%>" class="menu-link">
                    <span class="menu-icon fas fa-plug"></span> <span class="menu-text">Plugins</span>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/player?guildId=<%=guildId%> " class="menu-link">
                    <span class="menu-icon fas fa-file-alt"></span> <span class="menu-text">Player</span>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/history?guildId=<%=guildId%>" class="menu-link">
                    <span class="menu-icon fas fa-history"></span> <span class="menu-text">History</span>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/members?guildId=<%=guildId%>" class="menu-link">
                    <span class="menu-icon fas fa-users"></span> <span class="menu-text">Members</span>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/welcome?guildId=<%=guildId%>" class="menu-link">
                    <span class="menu-icon fas fas fa-handshake"></span> <span class="menu-text">Welcome</span>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/reactionroles?guildId=<%=guildId%>" class="menu-link">
                    <span class="menu-icon fas fa-server"></span> <span class="menu-text">Reaction Roles</span>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/automod?guildId=<%=guildId%>" class="menu-link">
                    <span class="menu-icon fas fa-hammer"></span> <span class="menu-text">Auto Moderation</span>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/sendmessage?guildId=<%=guildId%>" class="menu-link">
                    <span class="menu-icon fas fa-message"></span> <span class="menu-text">Send Message</span>
                  </a>
                </li>
                <li class="menu-item has-active">
                  <a href="/levels?guildId=<%=guildId%>" class="menu-link">
                    <span class="menu-icon fas fa-turn-up"></span> <span class="menu-text">Levels</span>
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </aside>
  <main class="app-main">
    <div class="container-fluid p-4">
      <h2 class="mb-4">Levels Settings</h2>
      <% if(!success !='' ){ %>
        <% } else {%>
          <div class="alert alert-success has-icon alert-dismissible fade show">
            <button type="button" class="close" data-dismiss="alert">×</button>
            <div class="alert-icon">
              <span class="oi oi-flag"></span>
            </div>
            <h4 class="alert-heading"> Success! </h4>
            <p class="mb-0">
              <%=success%>
            </p>
          </div>
          <% } %>
            <form method="POST" action="/levels-settings/save/<%= guildId %>">
              <input type="hidden" name="guildId" value="<%= guildId %>">
              <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" id="levelsEnabled" name="levelsEnabled" value="1" <% if
                  (settings.levelsEnabled) { %> checked <% } %>
                  >
                  <label class="form-check-label" for="levelsEnabled">
                    Enable Levels System
                  </label>
              </div>

              <div class="form-group mb-3">
                <label for="xpPerMessage">XP per Message:</label>
                <input type="number" class="form-control" id="xpPerMessage" name="xpPerMessage"
                  value="<%= settings.xp_per_message %>">
              </div>

              <div class="form-group mb-3">
                <label for="levelUpChannel">Level Up Announcement Channel:</label>
                <select name="levelUpChannel" class="form-control">
                  <option value="">Disabled</option>
                  <% channels.forEach(channel=> { %>
                    <option value="<%= channel.id %>" <%=settings.level_up_channel===channel.id ? 'selected' : '' %>><%=
                        channel.name %>
                    </option>
                    <% }) %>
                </select>
              </div>

              <div class="form-group mb-3">
                <label for="levelUpMessage">Level Up Message:</label>
                <textarea name="levelUpMessage" rows="3" class="form-control"
                  placeholder="Use {user} and {level} placeholders"><%= settings.custom_level_message || 'Congratulations {user}, you reached level {level}!' %></textarea>
              </div>

              <h4 class="mt-4 mb-2">Level Roles</h4>
              <div id="levelRoles">
                <% if (settings.level_roles && settings.level_roles.length> 0) { %>
                  <% settings.level_roles.forEach(roleSetting=> { %>
                    <div class="form-row mb-2 level-role-entry">
                      <div class="col-md-3">
                        <input type="number" name="levels[]" class="form-control" value="<%= roleSetting.level %>"
                          placeholder="Level" required>
                      </div>
                      <div class="col-md-3">
                        <input type="number" name="xps[]" class="form-control"
                          value="<%= roleSetting.required_xp %>" placeholder="XP" required>
                      </div>
                      <div class="col-md-4">
                        <select class="form-control" name="roles[]">
                          <option value="">No Role</option>
                          <% roles.forEach(role=> { %>
                            <option value="<%= role.id %>" <%=roleSetting.role_id===role.id ? 'selected' : '' %>><%=
                                role.name %>
                            </option>
                            <% }) %>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <button type="button" class="btn btn-danger" onclick="removeLevelRole(this)">🗑️</button>
                      </div>
                    </div>
                    <% }) %>
                      <% } %>
              </div>

              <button type="button" class="btn btn-secondary mt-2" onclick="addLevelRole()">Add Level Role</button>

    </div>

    <button type="submit" class="btn btn-primary mt-3">Save Levels Settings</button>
    </form>
    </div>

    <footer class="app-footer">
      <ul class="list-inline">
        <li class="list-inline-item"><a class="text-muted" href="https://github.com/Vasilew69"
            target="_blank">GitHub</a></li>
        <li class="list-inline-item"><a class="text-muted" href="https://discord.gg/2WhmVYwzNA" target="_blank">Discord
            Server</a></li>
      </ul>
      <div class="copyright">Dashboard - Vasilew__</div>
    </footer>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
    integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
    crossorigin="anonymous"></script>
  <script src="./home/assets/vendor/popper-js/umd/popper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"
    integrity="sha512-XKa9Hemdy1Ui3KSGgJdgMyYlUg1gM+QhL6cnlyTe2qzMCYm4nAZ1PsVerQzTTXzonUR+dmswHqgJPuwCq1MaAg=="
    crossorigin="anonymous"></script>
  <script src="./home/assets/javascript/theme.min.js"></script>
  <script>
    document.querySelectorAll('.dropdown-toggle').forEach(function (button) {
      button.addEventListener('click', function () {
        const dropdownMenu = this.parentElement.querySelector('.dropdown-menu');
        if (dropdownMenu.style.display === "block") {
          dropdownMenu.style.display = "none";
        } else {
          dropdownMenu.style.display = "block";
        }
      });
    });
    function addLevelRole() {
      const levelRolesContainer = document.getElementById("levelRoles");

      const div = document.createElement("div");
      div.className = "form-row mb-2 level-role-entry";

      div.innerHTML = `
      <div class="col-md-3">
        <input type="number" name="levels[]" class="form-control" placeholder="Level" required>
      </div>
      <div class="col-md-3">
        <input type="number" name="xps[]" class="form-control" placeholder="XP" required>
      </div>
      <div class="col-md-4">
        <select class="form-control" name="roles[]">
          <option value="">No Role</option>
          <% roles.forEach(role => { %>
            <option value="<%= role.id %>"><%= role.name %></option>
          <% }) %>
        </select>
      </div>
      <div class="col-md-2">
        <button type="button" class="btn btn-danger" onclick="removeLevelRole(this)">🗑️</button>
      </div>
    `;

      levelRolesContainer.appendChild(div);
    }

    function removeLevelRole(button) {
      const entry = button.closest('.level-role-entry');
      if (entry) entry.remove();
    }
  </script>
</body>

</html>